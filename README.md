# PinkClub-FANZA

FANZA 商品データを取得して表示するための、サーバー設置型ツールです。  
管理画面からサイト設定・API設定・リンク設定・固定ページ・広告コードなどを管理できます。

---

## 主な機能

### 1. 管理画面ログイン
- 管理画面ログイン（セッション管理）
- ログアウト
- 管理者パスワード変更（サイト設定内）

### 2. ダッシュボード
- 管理画面のトップに「ダッシュボード」
- DB接続、初期化、API設定、作品件数、最終インポートなどの確認（実装状況に応じて表示）

### 3. サイト設定
- サイト名
- サイトURL
- 管理者メールアドレス
- 管理者パスワード変更

### 4. API設定（FANZA）
- API ID
- アフィリエイト ID
- Site / Service / Floor
- タイムアウト設定
- API関連の各種パラメータ管理

### 5. リンク設定 / 相互リンク管理
- 相互リンクの登録・管理
- 表示順・有効/無効などの管理（実装状況に応じる）
- RSS連携のための基礎管理

### 6. RSS取得状況 / RSS管理
- RSSの取得・処理状況の確認
- 相互リンク連携用のRSS関連管理（実装状況に応じる）

### 7. アクセス解析
- 管理画面からアクセス状況の確認（実装済み範囲）

### 8. アフィリエイト設定
- API設定とは別に、表示・広告まわりの管理（実装済み範囲）

### 9. 広告コード
- 広告コードの登録・編集

### 10. 固定ページ
- 固定ページの新規作成
- 固定ページの編集
- フロント側への表示

### 11. メール
- 問い合わせ系メール機能（実装済み範囲）

---

## ディレクトリ概要（主要）

- `public/`
  - `index.php`（フロント）
  - `login*.php`（管理ログイン）
  - `admin/`（管理画面）
- `lib/`
  - DB接続、認証、設定、共通処理
- `storage/`
  - DB・キャッシュ・ログ系（構成により異なる）
- `config/`
  - 設定ファイル

---

## 初期セットアップ（概要）

1. サーバーに設置
2. `config`（または `config.local.php`）を環境に合わせて設定
   - DBホスト
   - DB名
   - DBユーザー
   - DBパスワード
3. 管理画面へアクセス
4. DB初期化（必要な場合）
5. API設定を入力（FANZA API）
6. サイト設定を調整
7. フロント表示を確認

---

## 管理画面メニュー（現行想定）

- ダッシュボード
- 設定
  - サイト設定
  - デザイン設定
- リンク設定
- 相互リンク管理
- RSS取得状況（または RSS管理）
- アクセス解析
- アフィリエイト設定
- API設定
- 広告コード
- 固定ページ
  - 新規
  - 編集
- メール

※ 実際の表示名は今後のUI調整で変更される場合があります。

---

## 補足

- 本ツール名「PinkClub-FANZA」は**ツール名**です。  
  フロント表示の「サイト名」は、運用するサイト名を別途設定してください。
- API項目やRSS項目の詳細は、今後の仕様調整に合わせて整理予定です。

---

## ライセンス

Private / 個人開発用（必要に応じて追記）

---

## 簡易ヘルスチェック手順（白画面再発防止）

1. **ログイン成功**
   - `/public/admin/login.php` にアクセスし、正しい管理者ID/パスワードでログイン。
   - `/public/admin/index.php` へ遷移できることを確認。

2. **ログイン失敗**
   - 誤ったID/パスワードでログインし、エラーメッセージが表示されることを確認。
   - 白画面にならず、ログイン画面に留まることを確認。

3. **ログアウト**
   - 管理画面からログアウト操作を実行し、ログイン画面へ戻ることを確認。
   - その後 `/public/admin/index.php` へ直接アクセスし、未ログインとして弾かれることを確認。

4. **サイトタイトル反映**
   - 管理画面のサイト設定でサイト名（site.title）を変更して保存。
   - フロントヘッダー・ログイン画面・管理画面ヘッダーに反映されることを確認。

5. **エラーログ確認**
   - ログファイル: `storage/logs/php-error.log`
   - 例: `tail -n 100 storage/logs/php-error.log`
   - 例外・Fatalが発生した際に追記されることを確認。

## 認証まわり改修後の確認手順

1. ログイン
   - `admin / password` で `/public/admin/login.php` からログインできること。
2. ログアウト
   - 管理画面のログアウトでセッションが切れ、再度管理画面に入るとログイン画面へ戻ること。
3. パスワード変更
   - 管理画面の「パスワード変更」から現在パスワードを使って変更できること。
4. 新パスワードで再ログイン
   - 変更後の新しいパスワードで再ログインできること。

---

## 管理画面 運用ガイド（STEP 9）

### 概要
- 管理画面で API から作品データを取得し、一覧確認・詳細確認・削除までを行う運用向けガイドです。

### 必要環境
- PHP 8.1 以上（推奨）
- MySQL 8 系（または互換バージョン）

### 初期設定（API設定）
1. 管理画面の「▶ 設定 → サイト設定」でサイトURLなど基本情報を保存。
2. 「▶ アフィリエイト設定 → API設定」で API ID / アフィリエイトID を保存。
3. API未設定のままではインポートを実行できません。

### 使い方（インポート → 一覧 → 詳細 → 削除）
1. 「インポート」画面で条件を指定して実行。
2. 実行後、成功/失敗メッセージと最終実行日時を確認。
3. 同画面の取得済みデータ一覧でキーワード/状態/件数を指定して確認。
4. 「詳細」で内容確認後、不要データは「削除」を実行。

### 注意点
- 削除は取り消しできません。
- API設定未入力時はインポート不可です。
