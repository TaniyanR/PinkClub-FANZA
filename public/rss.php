<?php declare(strict_types=1); require_once __DIR__ . '/../lib/db.php'; require_once __DIR__ . '/../lib/app_features.php'; require_once __DIR__ . '/partials/_helpers.php'; $pdo=db(); $sources=$pdo->query('SELECT * FROM rss_sources WHERE is_enabled=1')->fetchAll(PDO::FETCH_ASSOC); foreach($sources as $s){ if(empty($s['last_fetched_at']) || strtotime((string)$s['last_fetched_at']) < time()-900){ rss_fetch_source((int)$s['id'],2); break; } } $rows=$pdo->query('SELECT title,url,published_at,summary FROM rss_items ORDER BY published_at DESC,id DESC LIMIT 100')->fetchAll(PDO::FETCH_ASSOC); $pageTitle='RSS'; include __DIR__.'/partials/header.php'; include __DIR__.'/partials/nav_search.php'; echo '<div class="layout">'; include __DIR__.'/partials/sidebar.php'; ?><main class="main-content"><section class="block"><h1 class="section-title">RSS一覧</h1><?php foreach($rows as $r): ?><article><h3><a href="<?php echo e((string)$r['url']); ?>" target="_blank" rel="noopener noreferrer"><?php echo e((string)$r['title']); ?></a></h3><p><?php echo e((string)$r['published_at']); ?></p><p><?php echo e((string)$r['summary']); ?></p></article><?php endforeach; ?></section></main></div><?php include __DIR__.'/partials/footer.php';
