<?php declare(strict_types=1); require_once __DIR__ . '/_bootstrap.php'; require_once __DIR__ . '/../../lib/db.php'; function e(string $v): string { return htmlspecialchars($v, ENT_QUOTES | ENT_SUBSTITUTE | ENT_HTML5, 'UTF-8'); }
$pdo=db(); if(($_SERVER['REQUEST_METHOD']??'GET')==='POST' && csrf_verify((string)($_POST['_token']??''))){$id=(int)($_POST['id']??0);$data=[':n'=>trim((string)$_POST['site_name']),':s'=>trim((string)$_POST['site_url']),':l'=>trim((string)$_POST['link_url']),':st'=>trim((string)$_POST['status']),':note'=>trim((string)$_POST['note'])]; if($id>0){$st=$pdo->prepare('UPDATE mutual_links SET site_name=:n,site_url=:s,link_url=:l,status=:st,note=:note,updated_at=NOW() WHERE id=:id');$data[':id']=$id;$st->execute($data);} else {$st=$pdo->prepare('INSERT INTO mutual_links (site_name,site_url,link_url,status,note,created_at,updated_at) VALUES (:n,:s,:l,:st,:note,NOW(),NOW())');$st->execute($data);} }
$rows=$pdo->query('SELECT * FROM mutual_links ORDER BY id DESC')->fetchAll(PDO::FETCH_ASSOC); $pageTitle='相互リンク管理'; ob_start();?><h1>相互リンク管理</h1><form class="admin-card" method="post"><input type="hidden" name="_token" value="<?php echo e(csrf_token()); ?>"><input name="site_name" placeholder="site_name" required><input name="site_url" placeholder="https://..." required><input name="link_url" placeholder="掲載URL" required><select name="status"><option>pending</option><option>approved</option><option>rejected</option><option>disabled</option></select><input name="note" placeholder="note"><button>登録</button></form><div class="admin-card"><table><tr><th>site</th><th>status</th><th>url</th></tr><?php foreach($rows as $r): ?><tr><td><?php echo e((string)$r['site_name']); ?></td><td><?php echo e((string)$r['status']); ?></td><td><a href="<?php echo e((string)$r['site_url']); ?>" target="_blank" rel="noopener noreferrer"><?php echo e((string)$r['site_url']); ?></a></td></tr><?php endforeach; ?></table></div><?php $content=(string)ob_get_clean(); include __DIR__.'/../partials/admin_layout.php';
