<?php declare(strict_types=1); require_once __DIR__ . '/_bootstrap.php'; require_once __DIR__ . '/../../lib/db.php'; function e(string $v): string { return htmlspecialchars($v, ENT_QUOTES | ENT_SUBSTITUTE | ENT_HTML5, 'UTF-8'); }
$pdo=db(); if(($_SERVER['REQUEST_METHOD']??'GET')==='POST' && csrf_verify((string)($_POST['_token']??''))){$u=trim((string)$_POST['username']);$p=(string)$_POST['password']; if($u!==''&&$p!==''){$st=$pdo->prepare('INSERT INTO admin_users (username,password_hash,role,is_active,created_at) VALUES (:u,:p,\'admin\',1,NOW())');$st->execute([':u'=>$u,':p'=>password_hash($p,PASSWORD_DEFAULT)]);} }
$rows=$pdo->query('SELECT id,username,role,is_active,created_at FROM admin_users ORDER BY id DESC')->fetchAll(PDO::FETCH_ASSOC); $pageTitle='アカウント設定'; ob_start();?><h1>アカウント設定</h1><div class="admin-card"><p>古いハッシュ環境でも、ここで管理者パスワードを作成/更新できます。</p><p><a href="<?php echo e(admin_url('change_password.php')); ?>">現在のログインユーザーのパスワード変更</a></p></div><form class="admin-card" method="post"><input type="hidden" name="_token" value="<?php echo e(csrf_token()); ?>"><label>username</label><input name="username" required><label>password</label><input type="password" name="password" required><button>追加</button></form><div class="admin-card"><table><tr><th>id</th><th>username</th><th>role</th><th>active</th></tr><?php foreach($rows as $r): ?><tr><td><?php echo e((string)$r['id']); ?></td><td><?php echo e((string)$r['username']); ?></td><td><?php echo e((string)$r['role']); ?></td><td><?php echo e((string)$r['is_active']); ?></td></tr><?php endforeach; ?></table></div><?php $content=(string)ob_get_clean(); include __DIR__.'/../partials/admin_layout.php';
